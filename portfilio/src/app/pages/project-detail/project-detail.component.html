<app-header [showBack]="true" [backTitle]="project ? project.title : 'Retour'"></app-header>

@if (isDeleteModalOpen) {
  <app-confirm-modal
    title="Supprimer le projet ?"
    message="Voulez-vous vraiment supprimer ce projet définitivement ?"
    (confirm)="confirmDelete()"
    (cancel)="cancelDelete()">
  </app-confirm-modal>
}

<main class="project-detail-page">
  @if (project) {

    <section class="images-grid-container">

      <div class="main-image-wrapper">
        <img [src]="project.imageUrl" [alt]="project.title" class="img-cover">
      </div>

      @if (project.additionalImages && project.additionalImages.length > 0) {
        <div class="secondary-images-grid">
          @for (img of project.additionalImages.slice(0, 4); track $index) {
            <div class="sub-image-wrapper">
              <img [src]="img" alt="Gallery" class="img-cover">
            </div>
          }
        </div>
      }
    </section>

    <section class="header-section">

      <div class="title-block">
        <h1>{{ project.title }}</h1>

        <div class="authors-list">
          @for (author of project.authors; track author.id) {
            <div class="author-item clickable">
              <app-avatar [imageUrl]="author.avatarUrl" [name]="author.name" size="small"></app-avatar>
              <span class="author-name">{{ author.name }}</span>
            </div>
          }
        </div>
      </div>

      <div class="actions-block">

        <button class="action-btn fav" [class.active]="project.isFavorite" (click)="toggleFavorite()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" [attr.fill]="project.isFavorite ? 'currentColor' : 'none'" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
        </button>

        @if (isEditable) {
          <div class="menu-wrapper">
            <button class="action-btn edit" (click)="toggleMenu()">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
            </button>

            @if (isMenuOpen) {
              <div class="menu-overlay" (click)="isMenuOpen = false"></div>

              <div class="action-dropdown">
                <button class="dropdown-item" (click)="onEdit()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                  Modifier
                </button>
                <div class="divider"></div>
                <button class="dropdown-item delete" (click)="onDeleteRequest()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                  Supprimer
                </button>
              </div>
            }
          </div>
        }

      </div>
    </section>

    <section class="infos-section">

      <app-collapsible-section title="Présentation générale du projet" [isOpen]="true">
        <p>{{ project.description }}</p>

        <div class="tags-group">
          <strong>Langages utilisés :</strong>
          <div class="tags-list">
            @for (tag of project.tags; track tag) {
              <span class="tag-pill">{{ tag }}</span>
            }
          </div>
        </div>

        @if (project.links?.github) {
          <div class="links-group">
            <strong>Liens :</strong>
            <a [href]="project.links?.github" target="_blank" class="link-text">{{ project.links?.github }}</a>
          </div>
        }
      </app-collapsible-section>

      @if (project.origin) {
        <app-collapsible-section title="Origine du projet">
          <p>{{ project.origin }}</p>
        </app-collapsible-section>
      }

      @if (project.skillsLearned) {
        <app-collapsible-section title="Ce qu'ils ont appris">
          <p>{{ project.skillsLearned }}</p>
        </app-collapsible-section>
      }

    </section>

  } @else {
    <p class="loading">Chargement du projet...</p>
  }
</main>
<app-footer></app-footer>
