<div class="search-bar-container">

  <div class="input-wrapper">
    <svg xmlns="http://www.w3.org/2000/svg" class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
    <input type="text" [value]="searchQuery" (input)="onSearch($event)" placeholder="Rechercher un projet..." />
    @if (searchQuery) {
      <button class="btn-clear" (click)="clearSearch()" title="Effacer"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
    }
  </div>

  <div class="actions-group">

    <div class="dropdown-wrapper">
      <button class="btn-sort" [class.active]="isSortMenuOpen" (click)="toggleSortMenu()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>
        {{ currentSortLabel }}
      </button>

      @if (isSortMenuOpen) {
        <div class="sort-dropdown">
          <button (click)="selectSort('default', 'Tri par défaut')">Tri par défaut</button>
          <button (click)="selectSort('recent', 'Plus récents')">Plus récents</button>
          <button (click)="selectSort('az', 'Alphabétique (A-Z)')">Alphabétique (A-Z)</button>
          <button (click)="selectSort('za', 'Alphabétique (Z-A)')">Alphabétique (Z-A)</button>
        </div>
      }
    </div>

    <div class="dropdown-wrapper">
      <button class="btn-filter" [class.active]="isFilterMenuOpen || activeFilterCount > 0" (click)="toggleFilterMenu()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>
        Filtrer
        @if (activeFilterCount > 0) { <span class="badge">{{ activeFilterCount }}</span> }
      </button>

      @if (isFilterMenuOpen) {
        <div class="filter-dropdown">

          <div class="filter-header">
            <h3>Filtres</h3>
            <button class="btn-reset" (click)="resetFilters()">Tout effacer</button>
          </div>

          <div class="filter-scroll-content">

            <div class="filter-section" [class.disabled]="!filters.sectionsActive.tags">
              <div class="section-header" (click)="toggleExpansion('tags')">
                <div class="header-left">
                  <span class="chevron" [class.rotated]="!sectionsExpanded.tags">▼</span>
                  <span class="section-title">Langages & Tech</span>
                </div>
                <label class="switch" (click)="$event.stopPropagation()">
                  <input type="checkbox" [checked]="filters.sectionsActive.tags" (change)="toggleSection('tags', $event)">
                  <span class="slider round"></span>
                </label>
              </div>

              @if (sectionsExpanded.tags) {
                <div class="chips-grid">
                  @for (tag of availableTags; track tag) {
                    <label class="filter-chip">
                      <input type="checkbox"
                             [checked]="isItemChecked('tags', tag)"
                             (change)="toggleFilterItem('tags', tag)"
                             [disabled]="!filters.sectionsActive.tags">
                      <span>{{ tag }}</span>
                    </label>
                  }
                </div>
              }
            </div>

            <div class="filter-section" [class.disabled]="!filters.sectionsActive.modules">
              <div class="section-header" (click)="toggleExpansion('modules')">
                <div class="header-left">
                  <span class="chevron" [class.rotated]="!sectionsExpanded.modules">▼</span>
                  <span class="section-title">Modules</span>
                </div>
                <label class="switch" (click)="$event.stopPropagation()">
                  <input type="checkbox" [checked]="filters.sectionsActive.modules" (change)="toggleSection('modules', $event)">
                  <span class="slider round"></span>
                </label>
              </div>

              @if (sectionsExpanded.modules) {
                <div class="chips-grid">
                  @for (mod of availableModules; track mod) {
                    <label class="filter-chip">
                      <input type="checkbox"
                             [checked]="isItemChecked('modules', mod)"
                             (change)="toggleFilterItem('modules', mod)"
                             [disabled]="!filters.sectionsActive.modules">
                      <span>{{ mod }}</span>
                    </label>
                  }
                </div>
              }
            </div>

            <div class="filter-section" [class.disabled]="!filters.sectionsActive.promos">
              <div class="section-header" (click)="toggleExpansion('promos')">
                <div class="header-left">
                  <span class="chevron" [class.rotated]="!sectionsExpanded.promos">▼</span>
                  <span class="section-title">Promotion</span>
                </div>
                <label class="switch" (click)="$event.stopPropagation()">
                  <input type="checkbox" [checked]="filters.sectionsActive.promos" (change)="toggleSection('promos', $event)">
                  <span class="slider round"></span>
                </label>
              </div>

              @if (sectionsExpanded.promos) {
                <div class="chips-grid">
                  @for (promo of availablePromos; track promo) {
                    <label class="filter-chip">
                      <input type="checkbox"
                             [checked]="isItemChecked('promos', promo)"
                             (change)="toggleFilterItem('promos', promo)"
                             [disabled]="!filters.sectionsActive.promos">
                      <span>{{ promo }}</span>
                    </label>
                  }
                </div>
              }
            </div>

          </div>
        </div>
      }
    </div>

  </div>
</div>
